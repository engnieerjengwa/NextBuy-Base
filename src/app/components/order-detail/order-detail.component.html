<div class="main-content">
  <div class="section-content section-content-p30">
    <div class="container-fluid">
      <!-- Loading indicator -->
      <div *ngIf="isLoading" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <p>Loading order details...</p>
      </div>

      <!-- Error message -->
      <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <!-- Order details -->
      <div *ngIf="!isLoading && !errorMessage && order">
        <!-- 1. Order Header Bar -->
        <div class="order-header-bar">
          <div class="order-identifiers">
            <span class="order-number"
              >Order #{{ order.orderTrackingNumber }}</span
            >
            <span class="order-date"
              >ORDERED
              {{ order.dateCreated | date: "dd MMM yyyy" | uppercase }}</span
            >
            <span class="payment-date"
              >PAID
              {{ order.dateCreated | date: "dd MMM yyyy" | uppercase }}</span
            >
          </div>
          <div class="header-actions">
            <button class="btn btn-secondary" (click)="backToOrderHistory()">
              <i class="fa fa-arrow-left"></i> Back to Orders
            </button>
            <button class="btn btn-secondary" (click)="viewInvoice()">
              <i class="fa fa-eye"></i> View Invoices
            </button>
          </div>
        </div>

        <!-- 2. Order Info Grid (3 Columns) -->
        <div class="order-info-grid">
          <!-- Column 1: Shipping Address -->
          <div class="info-column shipping-address">
            <h3><i class="fa fa-map-marker"></i> Shipping Address</h3>
            <div class="address-content">
              <p *ngIf="order.customer">
                {{ order.customer.firstName }} {{ order.customer.lastName }}
              </p>
              <p *ngIf="order.shippingAddress">
                {{ order.shippingAddress.street }}
              </p>
              <p *ngIf="order.shippingAddress">
                {{ order.shippingAddress.city }}
              </p>
              <p *ngIf="order.shippingAddress">
                {{ order.shippingAddress.state }}
              </p>
              <p *ngIf="order.shippingAddress">
                {{ order.shippingAddress.country }}
              </p>
              <p *ngIf="order.shippingAddress">
                {{ order.shippingAddress.zipCode }}
              </p>
              <!-- Fallback if no shipping address -->
              <p *ngIf="!order.shippingAddress" class="text-muted">
                No shipping address available
              </p>
            </div>
          </div>

          <!-- Column 2: Delivery & Payment -->
          <div class="info-column delivery-payment">
            <div class="delivery-method">
              <h3><i class="fa fa-truck"></i> Delivery Method</h3>
              <p>Standard Delivery</p>
            </div>
            <div class="payment-method">
              <h3><i class="fa fa-credit-card"></i> Payment Method</h3>
              <p>Credit / Debit Card</p>
            </div>
          </div>

          <!-- Column 3: Order Summary -->
          <div class="info-column order-summary">
            <h3><i class="fa fa-list"></i> Order Summary</h3>
            <div class="summary-rows">
              <div class="summary-row">
                <span class="summary-label">Items Count</span>
                <span class="summary-value"
                  >{{ order.totalQuantity }} Items</span
                >
              </div>
              <div class="summary-row">
                <span class="summary-label">Amount</span>
                <span class="summary-value">{{
                  calculatedTotal | currency: "USD"
                }}</span>
              </div>
              <div class="summary-row">
                <span class="summary-label">Delivery</span>
                <span class="summary-value">{{ 0 | currency: "USD" }}</span>
              </div>
              <div class="summary-row divider"></div>
              <div class="summary-row">
                <span class="summary-label">Order Total:</span>
                <span class="summary-value">{{
                  calculatedTotal | currency: "USD"
                }}</span>
              </div>
              <div class="summary-row payment">
                <span class="summary-label">Paid (Credit / Debit Card)</span>
                <span class="summary-value negative"
                  >-{{ calculatedTotal | currency: "USD" }}</span
                >
              </div>
            </div>
          </div>
        </div>

        <!-- Delivery & Items Section -->
        <div class="delivery-items-container">
          <!-- Delivery Status Header -->
          <div class="delivery-status-header">
            <div class="delivery-status-info">
              <span class="delivery-status-text">
                <strong>Delivered</strong>
                {{ order.deliveryDate | date: "EEE, d MMM yyyy" }}
              </span>
            </div>
            <div class="delivery-actions" *ngIf="order.status === 'DELIVERED'">
              <button class="btn btn-secondary" (click)="logReturn()">
                <i class="fa fa-box"></i> Log Return
              </button>
            </div>
          </div>

          <!-- Proof of Delivery (Signature Row) -->
          <div class="proof-of-delivery" *ngIf="order.signedBy">
            <i class="fa fa-check-circle text-success"></i>
            <span
              >Signed by: {{ order.signedBy.name }} ({{
                order.signedBy.role === "CUSTOMER" ? "Customer" : "Concierge"
              }})</span
            >
          </div>

          <!-- Order Items List -->
          <div class="order-items-list">
            <!-- Display actual order items -->
            <div *ngFor="let item of order.orderItems" class="order-item">
              <div class="item-thumbnail">
                <a [routerLink]="['/products', item.productId]">
                  <img [src]="item.imageUrl" alt="Product Image" />
                </a>
              </div>
              <div class="item-details">
                <div class="item-name">
                  <a [routerLink]="['/products', item.productId]">
                    {{ item.productName || "Product #" + item.productId }}
                  </a>
                </div>
                <div class="item-quantity">Qty: {{ item.quantity }}</div>
                <div class="item-seller">Sold by: NexBuy Store</div>
              </div>
              <div class="item-price">
                {{ item.unitPrice | currency: "USD" }}
              </div>
            </div>

            <!-- Fallback if no order items -->
            <div
              *ngIf="!order.orderItems || order.orderItems.length === 0"
              class="alert alert-info"
            >
              No items found for this order.
            </div>
          </div>
        </div>
      </div>

      <!-- No order found -->
      <div
        *ngIf="!isLoading && !errorMessage && !order"
        class="alert alert-warning"
      >
        Order not found.
      </div>
    </div>
  </div>
</div>
